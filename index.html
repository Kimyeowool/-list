<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>추천곡</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: black;
      font-family: 'Arial', sans-serif;
    }

    #background-player {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      filter: blur(12px) brightness(0.3);
      pointer-events: none;
    }

    #mini-player {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 320px;
      height: 180px;
      z-index: 10;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid white;
    }

    .content {
      position: relative;
      z-index: 20;
      color: white;
      text-align: center;
      margin-top: 250px;
    }

    button {
      margin: 5px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="background-player"></div>
  <div id="mini-player"></div>

  <div class="content">
    <h1>오늘의 추천곡</h1>
    <p>장르를 선택해 주세요</p>
    <button onclick="fetchRandomSong('indie')">🎧 인디</button>
    <button onclick="fetchRandomSong('pop')">🎤 팝송</button>
    <button onclick="fetchRandomSong('japanese')">🎌 일본</button>
  </div>

  <script>
    let miniPlayer, backgroundPlayer;
    const playlists = {
      indie: ['dQw4w9WgXcQ', 'kXYiU_JCYtU'],
      pop: ['3JZ4pnNtyxQ', 'RgKAFK5djSk'],
      japanese: ['Zi_XLOBDo_Y', 'x8VYWazR5mE']
    };

    function fetchRandomSong(genre) {
      const list = playlists[genre];
      const randomId = list[Math.floor(Math.random() * list.length)];
      playVideo(randomId);
    }

    function playVideo(videoId) {
      if (miniPlayer && backgroundPlayer) {
        miniPlayer.loadVideoById(videoId);
        backgroundPlayer.loadVideoById(videoId);
      }
    }

    function onYouTubeIframeAPIReady() {
      const defaultId = 'dQw4w9WgXcQ';

      miniPlayer = new YT.Player('mini-player', {
        videoId: defaultId,
        playerVars: {
          autoplay: 1,
          controls: 1
        }
      });

      backgroundPlayer = new YT.Player('background-player', {
        videoId: defaultId,
        playerVars: {
          autoplay: 1,
          controls: 0,
          mute: 1,
          loop: 1,
          playlist: defaultId,
          modestbranding: 1,
          playsinline: 1
        },
        events: {
          onReady: e => e.target.mute()
        }
      });

      // 1초마다 싱크 맞추기
      setInterval(() => {
        const t1 = miniPlayer?.getCurrentTime?.();
        const t2 = backgroundPlayer?.getCurrentTime?.();
        if (typeof t1 === 'number' && typeof t2 === 'number' && Math.abs(t1 - t2) > 1) {
          backgroundPlayer.seekTo(t1, true);
        }
      }, 1000);
    }
  </script>

  <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
